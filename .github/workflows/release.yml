name: Release

on:
  push:
    tags:
      - 'v*'

permissions:
  contents: write

jobs:
  # ============================================
  # Stage 1: Build
  # ============================================
  build:
    name: Build
    uses: ./.github/workflows/jobs/01-build.yml
    with:
      go_version: '1.24'
    secrets: inherit

  # ============================================
  # Stage 2: Test
  # ============================================
  test:
    name: Test
    needs: build
    uses: ./.github/workflows/jobs/02-test.yml
    with:
      go_version: '1.24'
    secrets: inherit

  # ============================================
  # Stage 3: Publish
  # ============================================
  publish:
    name: Publish
    needs: [build, test]
    uses: ./.github/workflows/jobs/03-publish.yml
    with:
      go_version: '1.24'
    secrets: inherit

  # ============================================
  # Stage 4: Update Homebrew
  # ============================================
  release-brew:
    name: Update Homebrew
    needs: publish
    uses: ./.github/workflows/jobs/04-release-brew.yml
    with:
      tag_name: ${{ github.ref_name }}
    secrets: inherit

