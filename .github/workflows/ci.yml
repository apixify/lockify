name: CI

on:
  push:
    branches:
      - '*'

permissions:
  contents: read

jobs:
  # ============================================
  # Stage 1: Set Go Version
  # ============================================
  env:
    runs-on: ubuntu-latest
    outputs:
      go_version: ${{ steps.env.outputs.go_version }}
    steps:
      - name: Set go version
        id: env
        run: echo "go_version=1.24" >> $GITHUB_OUTPUT

  # ============================================
  # Stage 2: Build
  # ============================================
  build:
    name: Build
    needs: env
    uses: ./.github/workflows/build.yml
    with:
      go_version: ${{ needs.env.outputs.go_version }}
    secrets: inherit

  # ============================================
  # Stage 3: Test
  # ============================================
  test:
    name: Test
    needs: [env, build]
    uses: ./.github/workflows/test.yml
    with:
      go_version: ${{ needs.env.outputs.go_version }}
    secrets: inherit

  # ============================================
  # Stage 4: Lint
  # ============================================
  lint:
    name: Lint
    needs: [env, build]
    uses: ./.github/workflows/lint.yml
    with:
      go_version: ${{ needs.env.outputs.go_version }}
    secrets: inherit

